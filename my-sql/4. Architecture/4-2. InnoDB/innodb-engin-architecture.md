# Architecture

## InnoDB 
- MySQL에서 사용할 수 있는 스토리지 엔진 중 하나
- 레코드 기반의 잠금을 제공하여 높은 동시성 처리가 가능
- 안정적이고 성능이 타 엔진들보다 뛰어남
- 프라이머리키를 기준으로 클러스터링
  - 프라이머리 키 값의 순서대로 디스크에 저장
  - 모든 세컨더리 인덱스는 레코드의 주소 대신 프라이머리 키의 값을 논리적 주소로 사용
  - 프라이머리 키를 이용한 레인지 스캔은 상당히 빨리 처리가 가능함.
  - 실행 계획에서 프라이머리 키는 기본적으로 다른 보조 인덱스에 비해 비중이 높게 설정 됨.(다른 인덱스보다 프라이머리키가 실행계획에 선택될 확률이 높음)
  - 오라클의 IOT(Index Organized Table)과 동일한 구조
- 다른 엔진과 다르게 외래키 지원

### 용어정리
- Log Sequence Number (LSN)
기본적으로 리두 로그는 물리적으로 ib_logfile0 및 ib_logfile1이라는 두 개의 파일로 디스크에 표시됩니다. MySQL은 리두 로그 파일에 순환 방식으로 씁니다. 리두 로그의 데이터는 영향을받는 레코드로 인코딩됩니다. 이 데이터를 통틀어 리두라고합니다. 리두 로그를 통한 데이터 통과는 점점 증가하는 LSN 값으로 표시됩니다.
 
- 체크포인트(Checkpoint)
InnoDB는 체크포인트를 수행할 때 InnoDB 버퍼 풀에서 가장 오래된 더티 페이지의 LSN을 InnoDB 리두 로그에 기록합니다. 페이지가 InnoDB 버퍼 풀에서 가장 오래된 더티 페이지인 경우 LSN이 더 낮은 모든 페이지가 물리적 InnoDB 테이블스페이스 파일로 플러시되었음을 의미합니다. 서버가 충돌하면 InnoDB는 마지막 체크포인트에 기록된 가장 오래된 더티 페이지의 LSN보다 크거나 같은 LSN이 있는 로그 레코드만 적용하여 충돌 복구를 수행합니다.
체크포인트는 InnoDB 마스터 백그라운드 스레드가 수행하는 작업 중 하나입니다. 이 스레드는 서버가 매우 활성화되어 있을 때 7초 간격으로 체크포인트를 예약하지만 서버가 덜 활성화되면 체크포인트가 더 자주 발생할 수 있습니다.
더티 페이지는 실제로 체크포인트 동안 버퍼 풀에서 물리적 InnoDB 테이블스페이스 파일로 플러시되지 않습니다. 이 프로세스는 innodb_write_io_threads 시스템 변수에 의해 구성된 InnoDB의 쓰기 I/O 백그라운드 스레드에 의해 지속적으로 비동기적으로 발생합니다. 이 프로세스를 보다 적극적으로 만들고 싶다면 innodb_max_dirty_pages_pct 시스템 변수의 값을 줄일 수 있습니다. 또한 innodb_io_capacity 시스템 변수를 설정하여 시스템에서 InnoDB의 I/O 용량을 더 잘 조정해야 할 수도 있습니다.
 
- LRU
Least Recently Used List라고 합니다. 직역은 최근에 잘 사용되지 않은 목록입니다. DBMS의 메모리 관리기법중에 하나로 버퍼풀을 관리할 때 사용되는 알고리즘입니다.
 
- WAL
WAL 이란 용어도 자주 등장하는데 Write Ahead Log의 약자입니다.  InnoDB 에서는 Redo Log 로 불린다.

- Doublewrite Buffer
InnoDB 에서 데이터 파일의 적절한 위치에 페이지를 쓰기전에 버퍼풀에서 Flush 된 페이지를 쓰는 저장 영역입니다. 페이지 쓰기 도중에 스토리지/서브시스템/mysqld 프로세스 충돌이 있는 경우에는 Redo Log만을 이용하여 복구시도를 할때는 복구가 불가능하지만 Doublewrite Buffer를 이용해서 복구 할수 있습니다.
 
- Log Buffer
로그 버퍼는는 디스크의 리두 로그파일에 기록될 데이터를 보유하는 메모리 영역입니다. 로그 버퍼의 크기는 innodb_log_buffer_size 파라미터로 설정할 수 있습니다. (일반적으로 4MB ~ 16MB 가 좋은 크기라고 합니다.)로그 버퍼크기를 크게 조정하면 트랜잭션을 커밋 하기 전에 디스크에 로그를 쓰지않아도 큰 트랜잭션을 실행할수 있게 됩니다. 또한 많은 행을 업데이트, 삽입, 삭제하는 트랜잭션이 있는 경우 로그버퍼를 크게조정하면 DISK I/O 가 절약됩니다.

출처: https://myinfrabox.tistory.com/259 [MyInfraBox:티스토리]